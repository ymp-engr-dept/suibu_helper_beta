<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Suiren Audio Suite</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#4ecdc4">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@500;600;700&display=swap"
    rel="stylesheet">

  <link rel="stylesheet" href="index.css">
</head>

<body>
  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header class="app-header">
    <div class="header-left">
      <button class="drawer-trigger" id="menuToggle" aria-label="ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼">
        <svg class="menu-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
          <rect class="menu-line menu-line-1" y="3" width="20" height="2" rx="1" />
          <rect class="menu-line menu-line-2" y="9" width="20" height="2" rx="1" />
          <rect class="menu-line menu-line-3" y="15" width="20" height="2" rx="1" />
        </svg>
      </button>
      <div class="brand-logo">
        <span class="brand-name">SUIREN</span>
        <span class="brand-suffix">AUDIO</span>
        <span class="brand-version" id="appVersion">v0.0.0</span>
      </div>
      <!-- ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é€²æ—ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ -->
      <div class="download-indicator" id="downloadIndicator">
        <div class="download-spinner"></div>
        <span class="download-text">æº–å‚™ä¸­...</span>
        <div class="download-progress-bar">
          <div class="download-progress-fill" id="downloadProgressFill"></div>
        </div>
      </div>
    </div>
    <div class="header-center">
      <div class="status-indicator" id="globalStatusBadge">
        <span class="status-dot"></span>
        <span class="status-text">ã‚¿ãƒƒãƒ—ã—ã¦é–‹å§‹</span>
      </div>
    </div>
    <div class="header-right">
      <div class="mode-indicator" id="practiceModeIndicator">
        <span class="mode-icon">ğŸ‘¤</span>
        <span class="mode-text">å€‹äººç·´</span>
      </div>
    </div>
  </header>

  <!-- ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªè¨­å®šãƒ‘ãƒãƒ« -->
  <div class="global-audio-panel" id="globalAudioPanel">
    <div class="audio-controls-row">
      <!-- ãƒ‰ãƒ­ãƒ¯ãƒ¼é–‹é–‰ãƒœã‚¿ãƒ³ -->
      <button class="drawer-open-btn" id="drawerOpenBtn" aria-label="ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¿½åŠ ">
        <span class="drawer-open-icon">+</span>
        <span class="drawer-open-label">è¿½åŠ </span>
      </button>

      <!-- å…¥åŠ›è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <section class="panel-section">
        <span class="section-label">INPUT</span>
        <div class="control-group">
          <label class="control-item">
            <span class="label-text">GAIN</span>
            <input id="globalGainInput" type="number" value="1.0" min="0.1" max="10" step="0.1">
          </label>
          <label class="control-item">
            <span class="label-text">A4</span>
            <input id="globalA4Input" type="number" value="442" min="400" max="480" step="1">
          </label>
        </div>
      </section>

      <div class="panel-divider"></div>

      <!-- è¡¨è¨˜è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <section class="panel-section">
        <span class="section-label">NOTE</span>
        <div class="control-group">
          <select id="globalNotationSelect">
            <option value="C">English</option>
            <option value="JP_C">æ—¥æœ¬èª</option>
            <option value="JP_Bb">Bâ™­ç®¡</option>
            <option value="JP_Eb">Eâ™­ç®¡</option>
            <option value="JP_F">Fç®¡</option>
          </select>
        </div>
      </section>

      <div class="panel-divider"></div>

      <!-- éŒ²éŸ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <section class="panel-section">
        <span class="section-label">REC</span>
        <div class="control-group button-group">
          <button id="globalFreezeBtn" class="btn icon-btn" title="ãƒ•ãƒªãƒ¼ã‚º">â„ï¸</button>
          <button id="globalRecordBtn" class="btn icon-btn record-btn" title="éŒ²éŸ³">âº</button>
          <label class="btn icon-btn file-btn" title="ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ">
            ğŸ“
            <input type="file" id="globalFileInput" accept="audio/*" hidden>
          </label>
        </div>
      </section>

      <div class="panel-divider"></div>

      <!-- ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <section class="panel-section">
        <span class="section-label">MODE</span>
        <div class="control-group mode-group">
          <label class="mode-switch">
            <input type="checkbox" id="globalSourceModeCheckbox">
            <span class="slider"></span>
            <span class="mode-label">File</span>
          </label>
        </div>
        <div class="control-group mode-group">
          <label class="practice-mode-switch" id="practiceModeSwitch">
            <span class="practice-mode-label solo-label">å€‹äºº</span>
            <input type="checkbox" id="globalPracticeModeCheckbox">
            <span class="practice-slider"></span>
            <span class="practice-mode-label ensemble-label">åˆå¥</span>
          </label>
        </div>
      </section>

      <div class="panel-divider"></div>

      <!-- ãƒã‚¤ã‚ºé™¤å»ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <section class="panel-section" id="noiseReductionSection">
        <span class="section-label">NOISE</span>
        <div class="control-group">
          <button id="noiseCalibrationBtn" class="btn noise-cal-btn" title="ãƒã‚¤ã‚ºã‚­ãƒ£ãƒªãƒ–ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³">
            ğŸ”‡ å­¦ç¿’
          </button>
          <span id="noiseStatusIndicator" class="noise-status">OFF</span>
        </div>
      </section>

      <div class="panel-divider"></div>

      <!-- æ¥½å™¨é¸æŠã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <section class="panel-section" id="instrumentSection">
        <span class="section-label">INST</span>
        <div class="control-group">
          <select id="instrumentSelect" class="instrument-select">
            <option value="default">ğŸµ Default</option>
            <optgroup label="å¼¦æ¥½å™¨">
              <option value="guitar">ğŸ¸ ã‚®ã‚¿ãƒ¼</option>
              <option value="bass">ğŸ¸ ãƒ™ãƒ¼ã‚¹</option>
              <option value="violin">ğŸ» ãƒã‚¤ã‚ªãƒªãƒ³</option>
              <option value="cello">ğŸ» ãƒã‚§ãƒ­</option>
            </optgroup>
            <optgroup label="ç®¡æ¥½å™¨">
              <option value="flute">ğŸµ ãƒ•ãƒ«ãƒ¼ãƒˆ</option>
              <option value="clarinet">ğŸµ ã‚¯ãƒ©ãƒªãƒãƒƒãƒˆ</option>
              <option value="trumpet">ğŸº ãƒˆãƒ©ãƒ³ãƒšãƒƒãƒˆ</option>
              <option value="saxophone">ğŸ· ã‚µãƒƒã‚¯ã‚¹</option>
            </optgroup>
            <optgroup label="ãã®ä»–">
              <option value="voice">ğŸ¤ ãƒœãƒ¼ã‚«ãƒ«</option>
              <option value="piano">ğŸ¹ ãƒ”ã‚¢ãƒ</option>
            </optgroup>
          </select>
        </div>
      </section>

      <div class="panel-divider"></div>

      <!-- ãƒ—ãƒªã‚»ãƒƒãƒˆç®¡ç†ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
      <section class="panel-section preset-group">
        <span class="section-label">PRESET</span>
        <input type="text" id="presetNameInput" class="preset-name-input" placeholder="ãƒ—ãƒªã‚»ãƒƒãƒˆå">
        <button id="presetSaveBtn" class="btn">ğŸ’¾</button>
        <div class="preset-dropdown">
          <button id="presetListBtn" class="btn">ğŸ“‚ â–¼</button>
          <div class="preset-list" id="presetList">
            <!-- ãƒ—ãƒªã‚»ãƒƒãƒˆã¯JSã§å‹•çš„ç”Ÿæˆ -->
          </div>
        </div>
      </section>

      <!-- ãƒ—ãƒ¬ãƒ¼ãƒ¤ãƒ¼ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ -->
      <div class="player-compact disabled" id="globalPlayerInterface">
        <button id="globalPlayPauseBtn" class="icon-btn-sm" disabled>â–¶</button>
        <span id="globalCurrentTimeDisplay" class="time-sm">0:00</span>
        <input type="range" id="globalAudioSeekBar" value="0" step="0.01" min="0" max="100" disabled>
        <span id="globalDurationDisplay" class="time-sm">0:00</span>
        <input type="range" id="globalVolumeSlider" class="volume-sm" min="0" max="1" step="0.01" value="1" disabled>
        <select id="globalPlaybackRateSelect" class="rate-sm" disabled>
          <option value="0.5">x0.5</option>
          <option value="1.0" selected>x1</option>
          <option value="1.5">x1.5</option>
          <option value="2.0">x2</option>
        </select>
      </div>
    </div>
    <audio id="globalAudioEngine" style="display: none;"></audio>
  </div>

  <div class="app-body">
    <!-- ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ‰ãƒ­ãƒ¯ãƒ¼ï¼ˆã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ï¼‰ -->
    <aside class="module-drawer" id="moduleDrawer">
      <div class="drawer-content">
        <div class="drawer-header">Modules</div>
        <div class="module-list" id="moduleList">
          <!-- ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚«ãƒ¼ãƒ‰ã¯JSã§å‹•çš„ç”Ÿæˆ -->
        </div>
      </div>
    </aside>

    <!-- ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ -->
    <main class="workspace" id="workspace">
      <!-- ãƒ«ãƒ¼ãƒˆã‚³ãƒ³ãƒ†ãƒŠ -->
      <div class="layout-root" id="layoutRoot"></div>

      <!-- ç©ºã®çŠ¶æ…‹ -->
      <div class="workspace-empty" id="workspaceEmpty">
        <div class="empty-icon">ğŸ“¦</div>
        <div class="empty-text">ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—</div>
      </div>

      <!-- ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
      <div class="drop-zones" id="dropZones">
        <!-- ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ãŒç©ºã®æ™‚ã®å…¨ä½“ãƒ‰ãƒ­ãƒƒãƒ—ã‚¨ãƒªã‚¢ -->
        <div class="drop-zone zone-center" data-zone="center"></div>
        <!-- ã‚¨ãƒƒã‚¸ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ï¼ˆãƒ©ã‚¤ãƒ³è¡¨ç¤ºï¼‰ -->
        <div class="drop-zone zone-edge zone-top" data-zone="top"></div>
        <div class="drop-zone zone-edge zone-bottom" data-zone="bottom"></div>
        <div class="drop-zone zone-edge zone-left" data-zone="left"></div>
        <div class="drop-zone zone-edge zone-right" data-zone="right"></div>
      </div>
    </main>
  </div>

  <!-- ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ‘ãƒãƒ«ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ -->
  <template id="modulePanelTemplate">
    <div class="module-panel">
      <header class="panel-header">
        <span class="panel-drag-handle" title="ãƒ‰ãƒ©ãƒƒã‚°ã§ç§»å‹•">â‹®â‹®</span>
        <h3 class="panel-title"></h3>
        <button class="panel-menu-btn" title="ãƒ¡ãƒ‹ãƒ¥ãƒ¼">â‹¯</button>
      </header>
      <div class="panel-content"></div>
      <div class="panel-menu">
        <button class="menu-item delete-item">
          <span class="menu-icon">ğŸ—‘</span>
          <span class="menu-text">å‰Šé™¤</span>
          <div class="delete-progress"></div>
        </button>
      </div>
      <!-- ãƒ‘ãƒãƒ«å†…ãƒ‰ãƒ­ãƒƒãƒ—ã‚¾ãƒ¼ãƒ³ -->
      <div class="panel-drop-zones">
        <div class="panel-drop-zone pdz-top" data-zone="top"></div>
        <div class="panel-drop-zone pdz-bottom" data-zone="bottom"></div>
        <div class="panel-drop-zone pdz-left" data-zone="left"></div>
        <div class="panel-drop-zone pdz-right" data-zone="right"></div>
      </div>
    </div>
  </template>

  <!-- è¶…ä½é…å»¶ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ -->
  <script src="audio-core/AudioPipeline.js"></script>

  <!-- æ–°ãƒ”ãƒƒãƒæ¤œå‡ºã‚·ã‚¹ãƒ†ãƒ ï¼ˆä¸–ç•Œæœ€é«˜ç²¾åº¦ï¼‰ -->
  <!-- Audio Core Config (æœ€åˆã«èª­ã¿è¾¼ã‚€) -->
  <script src="audio-core/config.js"></script>

  <script src="audio-core/pitch-detection/utils/PitchUtils.js"></script>
  <script src="audio-core/pitch-detection/postprocessing/PostProcessing.js"></script>
  <script src="audio-core/pitch-detection/algorithms/PitchAlgorithms.js"></script>
  <script src="audio-core/pitch-detection/algorithms/AdvancedAlgorithms.js"></script>
  <script src="audio-core/pitch-detection/AdaptiveTrackingFilter.js"></script>

  <!-- 5å±¤è§£æã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ -->
  <!-- ViterbiDecoderã¨KalmanFilterã¯PostProcessing.jsã§å®šç¾©æ¸ˆã¿ -->
  <script src="audio-core/pitch-detection/layers/Layer1_CQT.js"></script>
  <script src="audio-core/pitch-detection/layers/Layer4_SuperResolution.js"></script>
  <script src="audio-core/pitch-detection/layers/Layer5_Strobe.js"></script>

  <!-- çµ±åˆãƒ”ãƒƒãƒã‚¨ãƒ³ã‚¸ãƒ³ï¼ˆå…¨ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ çµ±åˆï¼‰ -->
  <script src="audio-core/UnifiedPitchEngine.js"></script>
  <script src="audio-core/UnifiedPitchDispatcher.js"></script>

  <!-- ãƒã‚¤ã‚ºé™¤å»ã‚·ã‚¹ãƒ†ãƒ  -->
  <script src="audio-core/noise-reduction/NoiseReductionManager.js"></script>
  <script src="audio-core/noise-reduction/NoiseCalibrationUI.js"></script>

  <!-- PWAç®¡ç† -->
  <script src="PWAManager.js"></script>
  <script src="DownloadIndicatorManager.js"></script>


  <!-- PowerManagerï¼ˆçœé›»åŠ›ç®¡ç†ï¼‰ -->
  <script src="audio-core/PowerManager.js"></script>
  <script src="index.js"></script>
  <script>
    // ãƒãƒ¼ã‚¸ãƒ§ãƒ³è¡¨ç¤ºã‚’æ›´æ–°
    (async function () {
      try {
        // Service Workerã‹ã‚‰ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å–å¾—
        const response = await fetch('./service-worker.js');
        const text = await response.text();
        const match = text.match(/CACHE_NAME\s*=\s*['"]([^'"]+)['"]/);
        if (match && match[1]) {
          const version = match[1].replace('suiren-audio-', '');
          document.getElementById('appVersion').textContent = version;
        }
      } catch (e) {
        console.log('Version fetch failed:', e);
      }
    })();
  </script>
</body>

</html>