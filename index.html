<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Suiren Audio Suite</title>
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#4ecdc4">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=JetBrains+Mono:wght@400;500&family=Outfit:wght@500;600;700&display=swap"
    rel="stylesheet">

  <link rel="stylesheet" href="index.css">
</head>

<body>
  <!-- „Éò„ÉÉ„ÉÄ„Éº -->
  <header class="app-header">
    <div class="header-left">
      <button class="drawer-trigger" id="menuToggle" aria-label="„É¢„Ç∏„É•„Éº„É´„É°„Éã„É•„Éº">
        <svg class="menu-icon" width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
          <rect class="menu-line menu-line-1" y="3" width="20" height="2" rx="1" />
          <rect class="menu-line menu-line-2" y="9" width="20" height="2" rx="1" />
          <rect class="menu-line menu-line-3" y="15" width="20" height="2" rx="1" />
        </svg>
      </button>
      <div class="brand-logo">
        <span class="brand-name">SUIREN</span>
        <span class="brand-suffix">AUDIO</span>
        <span class="brand-version" id="appVersion">v0.0.0</span>
      </div>
    </div>
    <div class="header-center">
      <div class="status-indicator" id="globalStatusBadge">
        <span class="status-dot"></span>
        <span class="status-text">„Çø„ÉÉ„Éó„Åó„Å¶ÈñãÂßã</span>
      </div>
    </div>
    <div class="header-right">
      <div class="mode-indicator" id="practiceModeIndicator">
        <span class="mode-icon">üë§</span>
        <span class="mode-text">ÂÄã‰∫∫Á∑¥</span>
      </div>
    </div>
  </header>

  <!-- „Ç∞„É≠„Éº„Éê„É´„Ç™„Éº„Éá„Ç£„Ç™Ë®≠ÂÆö„Éë„Éç„É´ -->
  <div class="global-audio-panel" id="globalAudioPanel">
    <div class="audio-controls-row">
      <!-- „Éâ„É≠„ÉØ„ÉºÈñãÈñâ„Éú„Çø„É≥ -->
      <button class="drawer-open-btn" id="drawerOpenBtn" aria-label="„É¢„Ç∏„É•„Éº„É´ËøΩÂä†">
        <span class="drawer-open-icon">+</span>
        <span class="drawer-open-label">ËøΩÂä†</span>
      </button>

      <!-- ÂÖ•ÂäõË®≠ÂÆö„Çª„ÇØ„Ç∑„Éß„É≥ -->
      <section class="panel-section">
        <span class="section-label">INPUT</span>
        <div class="control-group">
          <label class="control-item">
            <span class="label-text">GAIN</span>
            <input id="globalGainInput" type="number" value="1.0" min="0.1" max="10" step="0.1">
          </label>
          <label class="control-item">
            <span class="label-text">A4</span>
            <input id="globalA4Input" type="number" value="442" min="400" max="480" step="1">
          </label>
        </div>
      </section>

      <div class="panel-divider"></div>

      <!-- Ë°®Ë®òË®≠ÂÆö„Çª„ÇØ„Ç∑„Éß„É≥ -->
      <section class="panel-section">
        <span class="section-label">NOTE</span>
        <div class="control-group">
          <select id="globalNotationSelect">
            <option value="C">English</option>
            <option value="JP_C">Êó•Êú¨Ë™û</option>
            <option value="JP_Bb">B‚ô≠ÁÆ°</option>
            <option value="JP_Eb">E‚ô≠ÁÆ°</option>
            <option value="JP_F">FÁÆ°</option>
          </select>
        </div>
      </section>

      <div class="panel-divider"></div>

      <!-- Èå≤Èü≥„Ç≥„É≥„Éà„É≠„Éº„É´„Çª„ÇØ„Ç∑„Éß„É≥ -->
      <section class="panel-section">
        <span class="section-label">REC</span>
        <div class="control-group button-group">
          <button id="globalFreezeBtn" class="btn icon-btn" title="„Éï„É™„Éº„Ç∫">‚ùÑÔ∏è</button>
          <button id="globalRecordBtn" class="btn icon-btn record-btn" title="Èå≤Èü≥">‚è∫</button>
          <label class="btn icon-btn file-btn" title="„Éï„Ç°„Ç§„É´ÈÅ∏Êäû">
            üìÅ
            <input type="file" id="globalFileInput" accept="audio/*" hidden>
          </label>
        </div>
      </section>

      <div class="panel-divider"></div>

      <!-- „É¢„Éº„ÉâÂàáÊõø„Çª„ÇØ„Ç∑„Éß„É≥ -->
      <section class="panel-section">
        <span class="section-label">MODE</span>
        <div class="control-group mode-group">
          <label class="mode-switch">
            <input type="checkbox" id="globalSourceModeCheckbox">
            <span class="slider"></span>
            <span class="mode-label">File</span>
          </label>
        </div>
        <div class="control-group mode-group">
          <label class="practice-mode-switch" id="practiceModeSwitch">
            <span class="practice-mode-label solo-label">ÂÄã‰∫∫</span>
            <input type="checkbox" id="globalPracticeModeCheckbox">
            <span class="practice-slider"></span>
            <span class="practice-mode-label ensemble-label">ÂêàÂ•è</span>
          </label>
        </div>
      </section>

      <div class="panel-divider"></div>

      <!-- „Éó„É™„Çª„ÉÉ„ÉàÁÆ°ÁêÜ„Çª„ÇØ„Ç∑„Éß„É≥ -->
      <section class="panel-section preset-group">
        <span class="section-label">PRESET</span>
        <input type="text" id="presetNameInput" class="preset-name-input" placeholder="„Éó„É™„Çª„ÉÉ„ÉàÂêç">
        <button id="presetSaveBtn" class="btn">üíæ</button>
        <div class="preset-dropdown">
          <button id="presetListBtn" class="btn">üìÇ ‚ñº</button>
          <div class="preset-list" id="presetList">
            <!-- „Éó„É™„Çª„ÉÉ„Éà„ÅØJS„ÅßÂãïÁöÑÁîüÊàê -->
          </div>
        </div>
      </section>

      <!-- „Éó„É¨„Éº„É§„Éº„Ç§„É≥„Çø„Éº„Éï„Çß„Éº„Çπ -->
      <div class="player-compact disabled" id="globalPlayerInterface">
        <button id="globalPlayPauseBtn" class="icon-btn-sm" disabled>‚ñ∂</button>
        <span id="globalCurrentTimeDisplay" class="time-sm">0:00</span>
        <input type="range" id="globalAudioSeekBar" value="0" step="0.01" min="0" max="100" disabled>
        <span id="globalDurationDisplay" class="time-sm">0:00</span>
        <input type="range" id="globalVolumeSlider" class="volume-sm" min="0" max="1" step="0.01" value="1" disabled>
        <select id="globalPlaybackRateSelect" class="rate-sm" disabled>
          <option value="0.5">x0.5</option>
          <option value="1.0" selected>x1</option>
          <option value="1.5">x1.5</option>
          <option value="2.0">x2</option>
        </select>
      </div>
    </div>
    <audio id="globalAudioEngine" style="display: none;"></audio>
  </div>

  <div class="app-body">
    <!-- „É¢„Ç∏„É•„Éº„É´„Éâ„É≠„ÉØ„ÉºÔºà„Ç™„Éº„Éê„Éº„É¨„Ç§Ôºâ -->
    <aside class="module-drawer" id="moduleDrawer">
      <div class="drawer-content">
        <div class="drawer-header">Modules</div>
        <div class="module-list" id="moduleList">
          <!-- „É¢„Ç∏„É•„Éº„É´„Ç´„Éº„Éâ„ÅØJS„ÅßÂãïÁöÑÁîüÊàê -->
        </div>
      </div>
    </aside>

    <!-- „ÉØ„Éº„ÇØ„Çπ„Éö„Éº„Çπ -->
    <main class="workspace" id="workspace">
      <!-- „É´„Éº„Éà„Ç≥„É≥„ÉÜ„Éä -->
      <div class="layout-root" id="layoutRoot"></div>

      <!-- Á©∫„ÅÆÁä∂ÊÖã -->
      <div class="workspace-empty" id="workspaceEmpty">
        <div class="empty-icon">üì¶</div>
        <div class="empty-text">„É¢„Ç∏„É•„Éº„É´„Çí„Éâ„É©„ÉÉ„Ç∞&„Éâ„É≠„ÉÉ„Éó</div>
      </div>

      <!-- „Éâ„É≠„ÉÉ„Éó„Çæ„Éº„É≥„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
      <div class="drop-zones" id="dropZones">
        <!-- „ÉØ„Éº„ÇØ„Çπ„Éö„Éº„Çπ„ÅåÁ©∫„ÅÆÊôÇ„ÅÆÂÖ®‰Ωì„Éâ„É≠„ÉÉ„Éó„Ç®„É™„Ç¢ -->
        <div class="drop-zone zone-center" data-zone="center"></div>
        <!-- „Ç®„ÉÉ„Ç∏„Éâ„É≠„ÉÉ„Éó„Çæ„Éº„É≥Ôºà„É©„Ç§„É≥Ë°®Á§∫Ôºâ -->
        <div class="drop-zone zone-edge zone-top" data-zone="top"></div>
        <div class="drop-zone zone-edge zone-bottom" data-zone="bottom"></div>
        <div class="drop-zone zone-edge zone-left" data-zone="left"></div>
        <div class="drop-zone zone-edge zone-right" data-zone="right"></div>
      </div>
    </main>
  </div>

  <!-- „É¢„Ç∏„É•„Éº„É´„Éë„Éç„É´„ÉÜ„É≥„Éó„É¨„Éº„Éà -->
  <template id="modulePanelTemplate">
    <div class="module-panel">
      <header class="panel-header">
        <span class="panel-drag-handle" title="„Éâ„É©„ÉÉ„Ç∞„ÅßÁßªÂãï">‚ãÆ‚ãÆ</span>
        <h3 class="panel-title"></h3>
        <button class="panel-menu-btn" title="„É°„Éã„É•„Éº">‚ãØ</button>
      </header>
      <div class="panel-content"></div>
      <div class="panel-menu">
        <button class="menu-item delete-item">
          <span class="menu-icon">üóë</span>
          <span class="menu-text">ÂâäÈô§</span>
          <div class="delete-progress"></div>
        </button>
      </div>
      <!-- „Éë„Éç„É´ÂÜÖ„Éâ„É≠„ÉÉ„Éó„Çæ„Éº„É≥ -->
      <div class="panel-drop-zones">
        <div class="panel-drop-zone pdz-top" data-zone="top"></div>
        <div class="panel-drop-zone pdz-bottom" data-zone="bottom"></div>
        <div class="panel-drop-zone pdz-left" data-zone="left"></div>
        <div class="panel-drop-zone pdz-right" data-zone="right"></div>
      </div>
    </div>
  </template>

  <!-- Ë∂Ö‰ΩéÈÅÖÂª∂„Ç™„Éº„Éá„Ç£„Ç™„Éë„Ç§„Éó„É©„Ç§„É≥ -->
  <script src="audio-core/AudioPipeline.js"></script>
  <script src="audio-core/PitchEngine.js"></script>
  <script src="audio-core/PowerManager.js"></script>
  <script src="index.js"></script>
  <script>
    // „Éê„Éº„Ç∏„Éß„É≥Ë°®Á§∫„ÇíÊõ¥Êñ∞
    (async function () {
      try {
        // Service Worker„Åã„Çâ„Éê„Éº„Ç∏„Éß„É≥„ÇíÂèñÂæó
        const response = await fetch('./service-worker.js');
        const text = await response.text();
        const match = text.match(/CACHE_NAME\s*=\s*['"]([^'"]+)['"]/);
        if (match && match[1]) {
          const version = match[1].replace('suiren-audio-', '');
          document.getElementById('appVersion').textContent = version;
        }
      } catch (e) {
        console.log('Version fetch failed:', e);
      }
    })();
  </script>
</body>

</html>